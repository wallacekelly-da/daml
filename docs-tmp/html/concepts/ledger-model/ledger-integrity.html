<!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Integrity &mdash; Daml SDK 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Privacy" href="ledger-privacy.html" />
  <link rel="prev" title="Structure" href="ledger-structure.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

  
  <!-- Mopinion Pastea.se  start --><script type="text/javascript">(function(){var id="4s6vwov7ad6qyxhq8iwbyhocrsn2nm36k25";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");js.async=true;document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script><!-- Mopinion Pastea.se end -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Daml Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation.html">Installing the SDK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/path-variables.html">Setting JAVA_HOME and PATH variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/manual-download.html">Manually installing the SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Building Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/app-architecture.html">App Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/first-feature.html">Your First Feature</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.daml.com/cheat-sheet">Cheat Sheet</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../daml/intro/0_Intro.html">An introduction to Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/1_Token.html">1 Basic contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/2_DamlScript.html">2 Testing templates using Daml Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/3_Data.html">3 Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/4_Transformations.html">4 Transforming data using choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/5_Restrictions.html">5 Adding constraints to a contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/6_Parties.html">6 Parties and authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/7_Composing.html">7 Composing choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/8_Exceptions.html">8 Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/9_Dependencies.html">9 Working with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/10_Functional101.html">10 Functional Programming 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/11_StdLib.html">11 Intro to the Daml Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/12_Testing.html">12 Testing Daml Contracts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/reference/index.html">Language reference docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/structure.html">Overview: template structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/stdlib/index.html">The standard library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/Prelude.html">Prelude</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Action.html">DA.Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Action-State.html">DA.Action.State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Action-State-Class.html">DA.Action.State.Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Assert.html">DA.Assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Bifunctor.html">DA.Bifunctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-BigNumeric.html">DA.BigNumeric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Date.html">DA.Date</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Either.html">DA.Either</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Exception.html">DA.Exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Foldable.html">DA.Foldable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Functor.html">DA.Functor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-List.html">DA.List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-List-BuiltinOrder.html">DA.List.BuiltinOrder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-List-Total.html">DA.List.Total</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Logic.html">DA.Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Map.html">DA.Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Math.html">DA.Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Monoid.html">DA.Monoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Next-Map.html">DA.Next.Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Next-Set.html">DA.Next.Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-NonEmpty.html">DA.NonEmpty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-NonEmpty-Types.html">DA.NonEmpty.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Numeric.html">DA.Numeric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Optional.html">DA.Optional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Optional-Total.html">DA.Optional.Total</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Record.html">DA.Record</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Semigroup.html">DA.Semigroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Set.html">DA.Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Stack.html">DA.Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Text.html">DA.Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-TextMap.html">DA.TextMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Time.html">DA.Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Traversable.html">DA.Traversable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Tuple.html">DA.Tuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/stdlib/DA-Validation.html">DA.Validation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/patterns.html">Good design patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/initaccept.html">Initiate and Accept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/multiparty-agreement.html">Multiple party agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/delegation.html">Delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/locking.html">Locking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-archiving.html">Locking by archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-state.html">Locking by state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-safekeeping.html">Locking by safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/legends.html">Diagram legends</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Building applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/app-arch.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/index.html">JavaScript Client Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml2js.html">JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/testing.html">Testing Your Web App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/index.html">HTTP JSON API Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/lf-value-specification.html">Daml-LF JSON Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/search-query-language.html">Query language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/production-setup.html">Production Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-script/index.html">Daml Script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml-script/api/index.html">Daml Script Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../daml-script/api/Daml-Script.html">Daml.Script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/index.html">Upgrading and Extending Daml applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/extend.html">Extending Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/upgrade.html">Upgrading Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/services.html">The Ledger API services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/index.html">gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/proto-docs.html">Ledger API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/daml-to-ledger-api.html">How Daml types are translated to protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/daml-lf-translation.html">How Daml types are translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/index.html">Java bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/codegen.html">Generate Java code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-scala/index.html">Scala bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-js.html">Node.js bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-x-lang/index.html">Creating your own bindings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/index.html">Daml Triggers - Off-Ledger Automation in Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../triggers/api/index.html">Daml Trigger Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/Daml-Trigger.html">Daml.Trigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/Daml-Trigger-Assert.html">Daml.Trigger.Assert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/Daml-Trigger-LowLevel.html">Daml.Trigger.LowLevel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/trigger-service/index.html">Trigger Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tools/trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/auth-middleware/index.html">Auth Middleware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tools/auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../error-codes/self-service/index.html">Self-Service Error Codes (Experimental)</a><ul class="simple">
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Deploying to Daml ledgers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/index.html">Overview of Daml ledgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/generic_ledger.html">Deploying to a generic Daml ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/ledger-topologies.html">Daml Ledger Topologies</a></li>
</ul>
<p class="caption"><span class="caption-text">Operating Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ops/index.html">Daml Participant pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/connect/index.html">Operating Daml Connect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/logs-and-metrics.html">Log Aggregation On Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/logs-and-metrics.html#daml-metrics-options">Daml Metrics Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/auth0.html">Setting Up Auth0</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/assistant.html">Daml Assistant (<code class="docutils literal notranslate"><span class="pre">daml</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/daml-studio.html">Daml Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sandbox.html">Daml Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/navigator/index.html">Navigator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/codegen.html">Daml codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler.html">Daml Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">Background concepts</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary of concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Daml Ledger Model</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ledger-structure.html">Structure</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="ledger-daml.html">Daml: Defining Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../identity-and-package-management.html">Identity and Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../time.html">Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../local-ledger.html">Causality and Local Ledgers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://daml.com/examples">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Early Access Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/extractor.html">Extractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/export/index.html">Ledger Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-integration-kit/index.html">Daml Integration Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tools/ledger-api-test-tool/index.html">Ledger API Test Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/visual.html">Visualizing Daml Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interoperability.html">Ledger Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/non-repudiation.html">Non-repudiation</a></li>
</ul>
<p class="caption"><span class="caption-text">Daml Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support/overview.html">Daml Ecosystem Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support/releases.html">Releases and Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/compatibility.html">Portability, Compatibility, and Support Durations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/support.html">Getting Help</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../../_static/images/DAML_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.daml.com/" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Integrity</a><ul>
<li><a class="reference internal" href="#valid-ledgers">Valid Ledgers</a></li>
<li><a class="reference internal" href="#consistency">Consistency</a><ul>
<li><a class="reference internal" href="#contract-consistency">Contract consistency</a></li>
<li><a class="reference internal" href="#key-consistency">Key consistency</a></li>
<li><a class="reference internal" href="#ledger-consistency">Ledger consistency</a></li>
<li><a class="reference internal" href="#internal-consistency">Internal consistency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conformance">Conformance</a></li>
<li><a class="reference internal" href="#authorization">Authorization</a><ul>
<li><a class="reference internal" href="#signatories-agreements-and-maintainers">Signatories, Agreements, and Maintainers</a></li>
<li><a class="reference internal" href="#authorization-rules">Authorization Rules</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#valid-ledgers-obligations-offers-and-rights">Valid Ledgers, Obligations, Offers and Rights</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="integrity">
<span id="da-model-integrity"></span><h1>Integrity<a class="headerlink" href="#integrity" title="Permalink to this headline">¶</a></h1>
<p>This section addresses the question of who can request which
changes.</p>
<div class="section" id="valid-ledgers">
<span id="da-model-validity"></span><h2>Valid Ledgers<a class="headerlink" href="#valid-ledgers" title="Permalink to this headline">¶</a></h2>
<p>At the core is the concept of a <em>valid ledger</em>; changes
are permissible if adding the corresponding commit to the
ledger results in a valid ledger. <strong>Valid ledgers</strong> are
those that fulfill three conditions:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#da-model-consistency"><span class="std std-ref">Consistency</span></a></dt>
<dd>Exercises and fetches on inactive contracts are not allowed, i.e.
contracts that have not yet been created or have already been
consumed by an exercise.
A contract with a contract key can be created only if the key is not associated to another unconsumed contract,
and all key assertions hold.</dd>
<dt><a class="reference internal" href="#da-model-conformance"><span class="std std-ref">Conformance</span></a></dt>
<dd>Only a restricted set of actions is allowed on a given contract.</dd>
<dt><a class="reference internal" href="#da-model-authorization"><span class="std std-ref">Authorization</span></a></dt>
<dd>The parties who may request a particular change are restricted.</dd>
</dl>
<p>Only the last of these conditions depends on the party (or
parties) requesting the change; the other two are general.</p>
</div>
<div class="section" id="consistency">
<span id="da-model-consistency"></span><h2>Consistency<a class="headerlink" href="#consistency" title="Permalink to this headline">¶</a></h2>
<p>Consistency consists of two parts:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#da-model-contract-consistency"><span class="std std-ref">Contract consistency</span></a>: Contracts must be created before they are used, and they cannot be used once they are consumed.</li>
<li><a class="reference internal" href="#da-model-key-consistency"><span class="std std-ref">Key consistency</span></a>: Keys are unique and key assertions are satisfied.</li>
</ol>
<p>To define this precisely, notions of “before” and “after” are needed.
These are given by putting all actions in a sequence. Technically, the
sequence is obtained by a pre-order traversal of the ledger’s actions,
noting that these actions form an (ordered) forest. Intuitively, it is obtained
by always picking parent actions before their proper subactions, and otherwise
always picking the actions on the left before the actions on the right. The image
below depicts the resulting order on the paint offer example:</p>
<div align="center" class="align-center"><img alt="../../_images/consistency-order-on-actions.svg" src="../../_images/consistency-order-on-actions.svg" width="100%" /></div>
<p>In the image, an action <cite>act</cite> happens before action <cite>act’</cite> if there is
a (non-empty) path from <cite>act</cite> to <cite>act’</cite>.
Then, <cite>act’</cite> happens after <cite>act</cite>.</p>
<div class="section" id="contract-consistency">
<span id="da-model-contract-consistency"></span><h3>Contract consistency<a class="headerlink" href="#contract-consistency" title="Permalink to this headline">¶</a></h3>
<p>Contract consistency ensures that contracts are used after they have been created and before they are consumed.</p>
<dl class="docutils" id="def-contract-consistency">
<dt>Definition »contract consistency«</dt>
<dd><p class="first">A ledger is <strong>consistent for a contract c</strong> if all of the following holds for all actions <cite>act</cite> on <cite>c</cite>:</p>
<ol class="last arabic simple">
<li>either <cite>act</cite> is itself <strong>Create c</strong> or a <strong>Create c</strong> happens before <cite>act</cite></li>
<li><cite>act</cite> does not happen before any <strong>Create c</strong> action</li>
<li><cite>act</cite> does not happen after any <strong>Exercise</strong> action consuming <cite>c</cite>.</li>
</ol>
</dd>
</dl>
<p>The consistency condition rules out the double spend example.
As the red path below indicates, the second exercise in the example happens after a consuming exercise on the same
contract, violating the contract consistency criteria.</p>
<div align="center" class="align-center"><img alt="../../_images/consistency-banning-double-spends.svg" src="../../_images/consistency-banning-double-spends.svg" width="100%" /></div>
<p id="def-contract-state">In addition to the consistency notions, the before-after relation on actions can also be used to define the notion of
<strong>contract state</strong> at any point in a given transaction.
The contract state is changed by creating the contract and by exercising it consumingly.
At any point in a transaction, we can then define the latest state change in the obvious way.
Then, given a point in a transaction, the contract state of <cite>c</cite> is:</p>
<ol class="arabic simple">
<li><strong>active</strong>, if the latest state change of <cite>c</cite> was a create;</li>
<li><strong>archived</strong>, if the latest state change of <cite>c</cite> was a consuming exercise;</li>
<li><strong>inexistent</strong>, if <cite>c</cite> never changed state.</li>
</ol>
<p>A ledger is consistent for <cite>c</cite> exactly if <strong>Exercise</strong> and <strong>Fetch</strong> actions on <cite>c</cite> happen only when <cite>c</cite> is active,
and <strong>Create</strong> actions only when <cite>c</cite> is inexistent.
The figures below visualize the state of different contracts at all points in the example ledger.</p>
<div class="figure align-center" id="id1">
<img alt="../../_images/consistency-paint-offer-activeness.svg" src="../../_images/consistency-paint-offer-activeness.svg" width="100%" /><p class="caption"><span class="caption-text">Activeness of the <cite>PaintOffer</cite> contract</span></p>
</div>
<div class="figure align-center" id="id2">
<img alt="../../_images/consistency-alice-iou-activeness.svg" src="../../_images/consistency-alice-iou-activeness.svg" width="100%" /><p class="caption"><span class="caption-text">Activeness of the <cite>Iou Bank A</cite> contract</span></p>
</div>
<p>The notion of order can be defined on all the different ledger structures: actions, transactions, lists of transactions,
and ledgers.
Thus, the notions of consistency, inputs and outputs, and contract state can also all be defined on all these
structures.
The <strong>active contract set</strong> of a ledger is the set of all contracts
that are active on the ledger. For the example above, it consists
of contracts <cite>Iou Bank P</cite> and <cite>PaintAgree P A</cite>.</p>
</div>
<div class="section" id="key-consistency">
<span id="da-model-key-consistency"></span><h3>Key consistency<a class="headerlink" href="#key-consistency" title="Permalink to this headline">¶</a></h3>
<p>Contract keys introduce a key uniqueness constraint for the ledger.
To capture this notion, the contract model must specify for every contract in the system whether the contract has a key and, if so, the key.
Every contract can have at most one key.</p>
<p>Like contracts, every key has a state.
An action <cite>act</cite> is an <strong>action on a key</strong> <cite>k</cite> if</p>
<ul class="simple">
<li><cite>act</cite> is a <strong>Create</strong>, <strong>Exercise</strong>, or a <strong>Fetch</strong> action on a contract <cite>c</cite> with key <cite>k</cite>, or</li>
<li><cite>act</cite> is the key assertion <strong>NoSuchKey</strong> <cite>k</cite>.</li>
</ul>
<dl class="docutils" id="def-key-state">
<dt>Definition »key state«</dt>
<dd><p class="first">The <strong>key state</strong> of a key on a ledger is determined by the last action <cite>act</cite> on the key:</p>
<ul class="last simple">
<li>If <cite>act</cite> is a <strong>Create</strong>, non-consuming <strong>Exercise</strong>, or <strong>Fetch</strong> action on a contract <cite>c</cite>,
then the key state is <strong>assigned</strong> to <cite>c</cite>.</li>
<li>If <cite>act</cite> is a consuming <strong>Exercise</strong> action or a <strong>NoSuchKey</strong> assertion,
then the key state is <strong>free</strong>.</li>
<li>If there is no such action <cite>act</cite>, then the key state is <strong>unknown</strong>.</li>
</ul>
</dd>
</dl>
<p>A key is <strong>unassigned</strong> if its key state is either <strong>free</strong> or <strong>unknown</strong>.</p>
<p>Key consistency ensures that there is at most one active contract for each key and that all key assertions are satisfied.</p>
<dl class="docutils" id="def-key-consistency">
<dt>Definition »key consistency«</dt>
<dd><p class="first">A ledger is <strong>consistent for a key</strong> <cite>k</cite> if for every action <cite>act</cite> on <cite>k</cite>, the key state <cite>s</cite> before <cite>act</cite> satisfies</p>
<ul class="last simple">
<li>If <cite>act</cite> is a <strong>Create</strong> action or <strong>NoSuchKey</strong> assertion, then <cite>s</cite> is <strong>free</strong> or <strong>unknown</strong>.</li>
<li>If <cite>act</cite> is an <strong>Exercise</strong> or <strong>Fetch</strong> action on some contract <cite>c</cite>, then <cite>s</cite> is <strong>assigned</strong> to <cite>c</cite> or <strong>unknown</strong>.</li>
</ul>
</dd>
</dl>
<p>Key consistency rules out the problematic examples around key consistency.
For example, suppose that the painter <cite>P</cite> has made a paint offer to <cite>A</cite> with reference number <cite>P123</cite>, but <cite>A</cite> has not yet accepted it.
When <cite>P</cite> tries to create another paint offer to <cite>David</cite> with the same reference number <cite>P123</cite>,
then this creation action would violate key uniqueness.
The following ledger violates key uniqueness for the key <cite>(P, P123)</cite>.</p>
<div class="figure align-center" id="double-key-creation">
<img alt="../../_images/double-key-creation-highlighted.svg" src="../../_images/double-key-creation-highlighted.svg" /></div>
<p>Key assertions can be used in workflows to evidence the inexistence of a certain kind of contract.
For example, suppose that the painter <cite>P</cite> is a member of the union of painters <cite>U</cite>.
This union maintains a blacklist of potential customers that its members must not do business with.
A customer <cite>A</cite> is considered to be on the blacklist if there is an active contract <cite>Blacklist &#64;U &amp;A</cite>.
To make sure that the painter <cite>P</cite> does not make a paint offer if <cite>A</cite> is blacklisted,
the painter combines its commit with a <strong>NoSuchKey</strong> assertion on the key <cite>(U, A)</cite>.
The following ledger shows the transaction, where <cite>UnionMember U P</cite> represents <cite>P</cite>’s membership in the union <cite>U</cite>.
It grants <cite>P</cite> the choice to perform such an assertion, which is needed for <a class="reference internal" href="#da-model-authorization"><span class="std std-ref">authorization</span></a>.</p>
<div class="figure align-center" id="paint-offer-blacklist">
<img alt="../../_images/paint-offer-blacklist.svg" src="../../_images/paint-offer-blacklist.svg" /></div>
<p>Key consistency extends to actions, transactions and lists of transactions just like the other consistency notions.</p>
</div>
<div class="section" id="ledger-consistency">
<span id="da-model-ledger-consistency"></span><h3>Ledger consistency<a class="headerlink" href="#ledger-consistency" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Definition »ledger consistency«</dt>
<dd>A ledger is <strong>consistent</strong> if it is consistent for all contracts and for all keys.</dd>
</dl>
</div>
<div class="section" id="internal-consistency">
<h3>Internal consistency<a class="headerlink" href="#internal-consistency" title="Permalink to this headline">¶</a></h3>
<p>The above consistency requirement is too strong for actions and transactions
in isolation.
For example, the acceptance transaction from the paint offer example is not consistent as a ledger, because <cite>PaintOffer A P Bank</cite>
and the <cite>Iou Bank A</cite> contracts are used without being created before:</p>
<div align="center" class="align-center"><img alt="../../_images/action-structure-paint-offer.svg" src="../../_images/action-structure-paint-offer.svg" width="60%" /></div>
<p>However, the transaction can still be appended to a ledger
that creates these contracts and yields a consistent ledger. Such
transactions are said to be internally consistent,
and contracts such as the <cite>PaintOffer A P Bank P123</cite> and <cite>Iou Bank A</cite> are called
input contracts of the transaction.
Dually, output contracts of a transaction are the contracts that a transaction creates and does not archive.</p>
<dl class="docutils" id="def-internal-consistency">
<dt>Definition »internal consistency for a contract«</dt>
<dd><p class="first">A transaction is <strong>internally consistent for a contract c</strong> if the following holds for all of its subactions <cite>act</cite> on the contract <cite>c</cite></p>
<ol class="arabic simple">
<li><cite>act</cite> does not happen before any <strong>Create c</strong> action</li>
<li><cite>act</cite> does not happen after any exercise consuming <cite>c</cite>.</li>
</ol>
<p class="last">A transaction is <strong>internally consistent</strong> if it is internally consistent for all contracts and consistent for all keys.</p>
</dd>
</dl>
<dl class="docutils" id="def-input-contract">
<dt>Definition »input contract«</dt>
<dd>For an internally consistent transaction,
a contract <cite>c</cite> is an <strong>input contract</strong> of the transaction
if the transaction contains an <strong>Exercise</strong> or a <strong>Fetch</strong> action on <cite>c</cite> but not a <strong>Create c</strong> action.</dd>
</dl>
<dl class="docutils" id="def-output-contract">
<dt>Definition »output contract«</dt>
<dd>For an internally consistent transaction,
a contract <cite>c</cite> is an <strong>output contract</strong> of the transaction
if the transaction contains a <strong>Create c</strong> action, but not a consuming <strong>Exercise</strong> action on <cite>c</cite>.</dd>
</dl>
<p>Note that
the input and output contracts are undefined for transactions that are not
internally consistent. The image below shows some examples of internally consistent
and inconsistent transactions.</p>
<div class="figure align-center" id="id3">
<img alt="../../_images/internal-consistency-examples.svg" src="../../_images/internal-consistency-examples.svg" width="100%" /><p class="caption"><span class="caption-text">The first two transactions violate the conditions of internal consistency.
The first transaction creates the <cite>Iou</cite> after exercising it consumingly, violating both conditions.
The second transaction contains a (non-consuming) exercise on the <cite>Iou</cite> after a consuming one, violating the second condition.
The last transaction is internally consistent.</span></p>
</div>
<p>Similar to input contracts, we define the input keys as the set that must be unassigned at the beginning of a transaction.</p>
<dl class="docutils">
<dt>Definition »input key«</dt>
<dd>A key <cite>k</cite> is an <strong>input key</strong> to an internally consistent transaction
if the first action <cite>act</cite> on <cite>k</cite> is either a <strong>Create</strong> action or a <strong>NoSuchKey</strong> assertion.</dd>
</dl>
<p>In the <a class="reference internal" href="#paint-offer-blacklist"><span class="std std-ref">blacklisting example</span></a>, <cite>P</cite>’s transaction has two input keys: <cite>(U, A)</cite> due to the <strong>NoSuchKey</strong> action and <cite>(P, P123)</cite> as it creates a <cite>PaintOffer</cite> contract.</p>
</div>
</div>
<div class="section" id="conformance">
<span id="da-model-conformance"></span><h2>Conformance<a class="headerlink" href="#conformance" title="Permalink to this headline">¶</a></h2>
<p>The <em>conformance</em> condition constrains the actions that may occur on the
ledger. This is done by considering a <strong>contract model</strong> <cite>M</cite> (or a <strong>model</strong> for short),
which specifies the set of all possible actions. A ledger is <strong>conformant to M</strong>
(or conforms to M) if all top-level actions on the ledger are members of <cite>M</cite>.
Like consistency, the notion of conformance does not depend on the requesters of
a commit, so it can also be applied to transactions and lists of transactions.</p>
<p>For example, the set of allowed actions on IOU contracts could be
described as follows.</p>
<div align="center" class="align-center"><img alt="../../_images/models-simple-iou.svg" src="../../_images/models-simple-iou.svg" width="80%" /></div>
<p>The boxes in the image are templates in the sense that the contract
parameters in a box (such as
obligor or owner) can be instantiated by arbitrary values of the
appropriate type. To facilitate understanding, each box includes a label
describing the intuitive purpose of the corresponding set of actions.
As the image suggests, the transfer box imposes the
constraint that the bank must remain the same both in the exercised
IOU contract, and in the newly created IOU contract. However, the
owner can change arbitrarily. In contrast, in the settle actions, both
the bank and the owner must remain the same.
Furthermore, to be conformant, the actor of a transfer action must be the same as the owner of the contract.</p>
<p>Of course, the constraints on the relationship between the parameters can be
arbitrarily complex, and cannot conveniently be reproduced in this
graphical representation. This is the role of Daml – it
provides a much more convenient way of representing contract models.
The link between Daml and contract models is explained in more detail in a <a class="reference internal" href="ledger-daml.html#da-model-daml"><span class="std std-ref">later section</span></a>.</p>
<p>To see the conformance criterion in action, assume that
the contract model allows only the following actions on <cite>PaintOffer</cite>
and <cite>PaintAgree</cite> contracts.</p>
<div align="center" class="align-center"><img alt="../../_images/models-paint-offer.svg" src="../../_images/models-paint-offer.svg" width="90%" /></div>
<p>The problem with example where Alice changes the
offer’s outcome to avoid transferring the money now
becomes apparent.</p>
<div align="center" class="align-center"><img alt="../../_images/non-conformant-action.svg" src="../../_images/non-conformant-action.svg" /></div>
<p><cite>A</cite>’s commit is not conformant to the contract model, as the model does
not contain the top-level action she is trying to commit.</p>
</div>
<div class="section" id="authorization">
<span id="da-model-authorization"></span><h2>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h2>
<p>The last criterion rules out the last two problematic examples,
<a class="reference internal" href="ledger-structure.html#obligation-imposed-on-painter"><span class="std std-ref">an obligation imposed on a painter</span></a>,
and <a class="reference internal" href="ledger-structure.html#painter-stealing-ious"><span class="std std-ref">the painter stealing Alice’s money</span></a>.
The first of those is visualized below.</p>
<div align="center" class="align-center"><img alt="../../_images/invalid-obligation.svg" src="../../_images/invalid-obligation.svg" width="100%" /></div>
<p>The reason why the example is intuitively impermissible is that
the <cite>PaintAgree</cite> contract is supposed to express that the painter has an
obligation to paint Alice’s house, but he never agreed to that obligation.
On paper contracts, obligations are expressed in the body of the contract,
and imposed on the contract’s <em>signatories</em>.</p>
<div class="section" id="signatories-agreements-and-maintainers">
<span id="da-signatories-agreements-maintainers"></span><h3>Signatories, Agreements, and Maintainers<a class="headerlink" href="#signatories-agreements-and-maintainers" title="Permalink to this headline">¶</a></h3>
<p>To capture these elements of real-world contracts, the <strong>contract model</strong>
additionally specifies, for each contract in the system:</p>
<ol class="arabic simple">
<li>A non-empty set of <strong>signatories</strong>, the parties bound by the
contract.</li>
<li>An optional <strong>agreement text</strong> associated with the contract,
specifying the off-ledger, real-world obligations of the
signatories.</li>
<li>If the contract is associated with a key, a non-empty set of <strong>maintainers</strong>,
the parties that make sure that at most one unconsumed contract exists for the key.
The maintainers must be a subset of the signatories and depend only on the key.
This dependence is captured by the function <cite>maintainers</cite> that takes a key and returns the key’s maintainers.</li>
</ol>
<p>In the example, the contract model specifies that</p>
<ol class="arabic simple">
<li>an <cite>Iou obligor owner</cite> contract has only the <cite>obligor</cite> as a signatory,
and no agreement text.</li>
<li>a <cite>MustPay obligor owner</cite> contract has both the <cite>obligor</cite>
and the <cite>owner</cite> as signatories, with an agreement text requiring
the obligor to pay the owner a certain amount, off the ledger.</li>
<li>a <cite>PaintOffer houseOwner painter obligor refNo</cite> contract has only the
painter as the signatory, with no agreement text.
Its associated key consists of the painter and the reference number.
The painter is the maintainer.</li>
<li>a <cite>PaintAgree houseOwner painter refNo</cite> contract has both the
house owner and the painter as signatories, with an agreement
text requiring the painter to paint the house.
The key consists of the painter and the reference number.
The painter is the only maintainer.</li>
</ol>
<p>In the graphical representation below, signatories of a contract are indicated
with a dollar sign (as a mnemonic for an obligation) and use a bold
font.
Maintainers are marked with <cite>&#64;</cite> (as a mnemonic who enforces uniqueness).
Since maintainers are always signatories, parties marked with <cite>&#64;</cite> are implicitly signatories.
For example, annotating the paint offer acceptance action with
signatories yields the image below.</p>
<div align="center" class="align-center"><img alt="../../_images/signatories-paint-offer.svg" src="../../_images/signatories-paint-offer.svg" width="60%" /></div>
</div>
<div class="section" id="authorization-rules">
<span id="da-ledgers-authorization-rules"></span><h3>Authorization Rules<a class="headerlink" href="#authorization-rules" title="Permalink to this headline">¶</a></h3>
<p>Signatories allow one to precisely state that the painter has an obligation.
The imposed obligation is intuitively invalid because the painter did not
agree to this obligation. In other words, the painter did not <em>authorize</em>
the creation of the obligation.</p>
<p>In a Daml ledger, a party can <strong>authorize</strong> a subaction of a commit in
either of the following ways:</p>
<ul class="simple">
<li>Every top-level action of the commit is authorized by all requesters
of the commit.</li>
<li>Every consequence of an exercise action <cite>act</cite> on a contract <cite>c</cite> is
authorized by all signatories of <cite>c</cite> and all actors of <cite>act</cite>.</li>
</ul>
<p>The second authorization rule encodes the offer-acceptance pattern,
which is a prerequisite for contract formation in contract law. The
contract <cite>c</cite> is effectively an offer by its signatories who act as
offerers. The exercise is an acceptance of the offer by the actors who
are the offerees. The consequences of the exercise can be interpreted
as the contract body so the authorization rules of Daml
ledgers closely model the rules for contract formation in contract
law.</p>
<p id="da-ledgers-required-authorizers"><span id="da-ledgers-def-well-authorized"></span>A commit is <strong>well-authorized</strong> if every subaction <cite>act</cite> of the commit is
authorized by at least all of the <strong>required authorizers</strong> of <cite>act</cite>, where:</p>
<ol class="arabic simple">
<li>the required authorizers of a <strong>Create</strong> action on a contract <cite>c</cite> are the
signatories of <cite>c</cite>.</li>
<li>the required authorizers of an <strong>Exercise</strong> or a <strong>Fetch</strong> action are its actors.</li>
<li>the required authorizers of a <strong>NoSuchKey</strong> assertion are the maintainers of the key.</li>
</ol>
<p>We lift this notion to ledgers, whereby a ledger is well-authorized exactly when all of its commits are.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>An intuition for how the authorization definitions work is most easily
developed by looking at some examples. The main example, the
paint offer ledger, is intuitively legitimate. It should therefore
also be well-authorized according to our definitions,
which it is indeed.</p>
<p>In the visualizations below,
<cite>Π ✓ act</cite> denotes that the parties <cite>Π</cite> authorize the
action <cite>act</cite>. The resulting authorizations are shown below.</p>
<div align="center" class="align-center"><img alt="../../_images/authorization-paint-offer.svg" src="../../_images/authorization-paint-offer.svg" /></div>
<p>In the first commit, the bank authorizes the creation of the IOU by
requesting that commit. As the bank is the sole signatory on the
IOU contract, this commit is well-authorized. Similarly, in the second
commit, the painter authorizes the creation of the paint offer contract,
and painter is the only signatory on that contract, making this commit
also well-authorized.</p>
<p>The third commit is more complicated. First, Alice authorizes
the exercise on the paint offer by requesting it. She is the only actor
on this exercise, so this complies with the authorization requirement.
Since the painter is the signatory of the paint offer, and Alice
the actor of the exercise, they jointly authorize all consequences
of the exercise. The first consequence is an exercise on the IOU, with
Alice as the actor; so this is permissible. The second
consequence is the creation of the paint agreement, which has Alice
and the painter as signatories. Since they both authorize this action,
this is also permissible. Finally, the creation of the new IOU (for P)
is a consequence of the exercise on the old one (for A). As the
old IOU was signed by the bank, and as Alice was the actor of
the exercise, the bank and Alice jointly authorize the
creation of the new IOU. Since the bank is the sole signatory of this
IOU, this action is also permissible. Thus, the entire third commit
is also well-authorized, and then so is the ledger.</p>
<p>Similarly, the intuitively problematic examples
are prohibited by our authorization criterion. In the
first example, Alice forced the painter to paint her house. The
authorizations for the example are shown below.</p>
<div align="center" class="align-center"><img alt="../../_images/authorization-invalid-obligation.svg" src="../../_images/authorization-invalid-obligation.svg" /></div>
<p>Alice authorizes the <strong>Create</strong> action on the <cite>PaintAgree</cite> contract by
requesting it. However, the painter is also a signatory on the
<cite>PaintAgree</cite> contract, but he did not authorize the <strong>Create</strong> action.
Thus, this ledger is indeed not well-authorized.</p>
<p>In the second example, the painter steals money from Alice.</p>
<div align="center" class="align-center"><img alt="../../_images/authorization-stealing-ious.svg" src="../../_images/authorization-stealing-ious.svg" /></div>
<p>The bank authorizes the creation of the IOU by requesting this action.
Similarly, the painter authorizes the exercise that transfers the IOU
to him. However, the actor of this exercise is Alice, who has not
authorized the exercise. Thus, this ledger is not
well-authorized.</p>
<p>The rationale for making the maintainers required authorizers for a <strong>NoSuchKey</strong> assertion
is discussed in the next section about <a class="reference internal" href="ledger-privacy.html#da-model-privacy-authorization"><span class="std std-ref">privacy</span></a>.</p>
</div>
</div>
<div class="section" id="valid-ledgers-obligations-offers-and-rights">
<h2>Valid Ledgers, Obligations, Offers and Rights<a class="headerlink" href="#valid-ledgers-obligations-offers-and-rights" title="Permalink to this headline">¶</a></h2>
<p>Daml ledgers are designed to mimic real-world interactions between
parties, which are governed by contract law. The validity conditions
on the ledgers, and the information contained in contract models have
several subtle links to the concepts of the contract law that are
worth pointing out.</p>
<p>First, in addition to the explicit off-ledger obligations specified in
the agreement text, contracts also specify implicit <strong>on-ledger
obligations</strong>, which result from consequences of the exercises on
contracts. For example, the <cite>PaintOffer</cite> contains an on-ledger
obligation for <cite>A</cite> to transfer her IOU in case she accepts the offer. Agreement
texts are therefore only necessary to specify obligations that are not
already modeled as permissible actions on the ledger. For example,
<cite>P</cite>’s obligation to paint the house cannot be sensibly modeled on the
ledger, and must thus be specified by the agreement text.</p>
<p>Second, every contract on a Daml ledger can simultaneously model both:</p>
<ul class="simple">
<li>a real-world offer, whose consequences (both on- and off-ledger)
are specified by the <strong>Exercise</strong> actions on the contract allowed
by the contract model, and</li>
<li>a real-world contract “proper”, specified through the contract’s
(optional) agreement text.</li>
</ul>
<p>Third, in Daml ledgers, as in the real world, one person’s rights are
another person’s obligations. For example, <cite>A</cite>’s right to accept the
<cite>PaintOffer</cite> is <cite>P</cite>’s obligation to paint her house in case she
accepts.
In Daml ledgers, a party’s rights according to a contract model are the exercise actions the party can perform according to the authorization and conformance rules.</p>
<p>Finally, validity conditions ensure three important properties of the Daml
ledger model, that mimic the contract law.</p>
<ol class="arabic">
<li><p class="first"><strong>Obligations need consent</strong>.
Daml ledgers follow the offer-acceptance pattern of the
contract law, and thus ensures that all ledger contracts are
formed voluntarily. For example, the following
ledger is not valid.</p>
<div align="center" class="align-center"><img alt="../../_images/authorization-invalid-obligation.svg" src="../../_images/authorization-invalid-obligation.svg" width="100%" /></div>
</li>
<li><p class="first"><strong>Consent is needed to take away on-ledger rights</strong>.
As only <strong>Exercise</strong> actions consume contracts, the rights cannot be taken
away from the actors; the contract model specifies exactly who the
actors are, and the authorization rules require them to approve the
contract consumption.</p>
<p>In the examples, Alice had the right to transfer her IOUs;
painter’s attempt to take that right away from her, by performing
a transfer himself, was not valid.</p>
<div align="center" class="align-center"><img alt="../../_images/authorization-stealing-ious.svg" src="../../_images/authorization-stealing-ious.svg" width="100%" /></div>
<p>Parties can still <strong>delegate</strong> their rights to other parties. For
example, assume that Alice, instead of accepting painter’s offer,
decides to make him a counteroffer instead. The painter can
then accept this counteroffer, with the consequences as before:</p>
<div align="center" class="align-center"><img alt="../../_images/counteroffer-acceptance.svg" id="counteroffer-acceptance" src="../../_images/counteroffer-acceptance.svg" width="60%" /></div>
<p>Here, by creating the <cite>CounterOffer</cite> contract, Alice delegates
her right to transfer the IOU contract to the painter. In case of
delegation, prior to submission, the requester must get informed about the contracts
that are part of the requested transaction, but where the requester
is not a signatory. In the example above, the
painter must learn about the existence of the IOU for Alice before
he can request the acceptance of the <cite>CounterOffer</cite>. The
concepts of observers and divulgence, introduced in the next
section, enable such scenarios.</p>
</li>
<li><p class="first"><strong>On-ledger obligations cannot be unilaterally escaped</strong>. Once an
obligation is recorded on a Daml ledger, it can only be removed in
accordance with the contract model. For example, assuming the IOU
contract model shown earlier, if the ledger records the creation
of a <cite>MustPay</cite> contract, the bank cannot later simply record an
action that consumes this contract:</p>
<div align="center" class="align-center"><img alt="../../_images/validity-no-removal-of-obligations.svg" src="../../_images/validity-no-removal-of-obligations.svg" width="100%" /></div>
<p>That is, this ledger is invalid, as the action above is not
conformant to the contract model.</p>
</li>
</ol>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ledger-structure.html" class="da-btn da-btn-label btn-prev" title="Structure" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="ledger-privacy.html" class="da-btn da-btn-label btn-next" title="Privacy" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>