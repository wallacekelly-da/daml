<!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OAuth 2.0 Auth Middleware &mdash; Daml SDK __VERSION__ documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/language_data.js"></script>
  <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
  <script type="text/javascript" src="../../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Self-Service Error Codes (Experimental)" href="../../error-codes/self-service/index.html" />
  <link rel="prev" title="Auth Middleware" href="index.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

  
  <!-- Mopinion Pastea.se  start --><script type="text/javascript">(function(){var id="4s6vwov7ad6qyxhq8iwbyhocrsn2nm36k25";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");js.async=true;document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script><!-- Mopinion Pastea.se end -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Daml Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation.html">Installing the SDK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/path-variables.html">Setting JAVA_HOME and PATH variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/manual-download.html">Manually installing the SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Building Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/app-architecture.html">App Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/first-feature.html">Your First Feature</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.daml.com/cheat-sheet">Cheat Sheet</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../daml/intro/0_Intro.html">An introduction to Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/1_Token.html">1 Basic contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/2_DamlScript.html">2 Testing templates using Daml Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/3_Data.html">3 Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/4_Transformations.html">4 Transforming data using choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/5_Restrictions.html">5 Adding constraints to a contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/6_Parties.html">6 Parties and authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/7_Composing.html">7 Composing choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/8_Exceptions.html">8 Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/9_Dependencies.html">9 Working with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/10_Functional101.html">10 Functional Programming 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/11_StdLib.html">11 Intro to the Daml Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/intro/12_Testing.html">12 Testing Daml Contracts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/reference/index.html">Language reference docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/structure.html">Overview: template structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/reference/exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/patterns.html">Good design patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/initaccept.html">Initiate and Accept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/multiparty-agreement.html">Multiple party agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/delegation.html">Delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/locking.html">Locking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-archiving.html">Locking by archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-state.html">Locking by state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../daml/patterns/locking/locking-by-safekeeping.html">Locking by safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../daml/patterns/legends.html">Diagram legends</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Building applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/app-arch.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/index.html">JavaScript Client Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml2js.html">JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/testing.html">Testing Your Web App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/index.html">HTTP JSON API Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/lf-value-specification.html">Daml-LF JSON Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/search-query-language.html">Query language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/production-setup.html">Production Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-script/index.html">Daml Script</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/index.html">Upgrading and Extending Daml applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/extend.html">Extending Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/upgrade.html">Upgrading Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/services.html">The Ledger API services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/index.html">gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/daml-to-ledger-api.html">How Daml types are translated to protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/daml-lf-translation.html">How Daml types are translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/index.html">Java bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/codegen.html">Generate Java code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-scala/index.html">Scala bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-js.html">Node.js bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-x-lang/index.html">Creating your own bindings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/index.html">Daml Triggers - Off-Ledger Automation in Daml</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../trigger-service/index.html">Trigger Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Auth Middleware</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../error-codes/self-service/index.html">Self-Service Error Codes (Experimental)</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../error-codes/self-service/index.html#self-service-error-codes-migration-guide">Self-Service Error Codes Migration Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Deploying to Daml ledgers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/index.html">Overview of Daml ledgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/generic_ledger.html">Deploying to a generic Daml ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/ledger-topologies.html">Daml Ledger Topologies</a></li>
</ul>
<p class="caption"><span class="caption-text">Operating Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ops/index.html">Daml Participant pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/connect/index.html">Operating Daml Connect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/helm.html">Connect Helm Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ops/connect/auth0.html">Setting Up Auth0</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../assistant.html">Daml Assistant (<code class="docutils literal notranslate"><span class="pre">daml</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml/daml-studio.html">Daml Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sandbox.html">Daml Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../navigator/index.html">Navigator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codegen.html">Daml codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">Daml Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">Background concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/glossary.html">Glossary of concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/index.html">Daml Ledger Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-structure.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-integrity.html">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-daml.html">Daml: Defining Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/identity-and-package-management.html">Identity and Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/time.html">Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/local-ledger.html">Causality and Local Ledgers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://daml.com/examples">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Early Access Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extractor.html">Extractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/index.html">Ledger Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-integration-kit/index.html">Daml Integration Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ledger-api-test-tool/index.html">Ledger API Test Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visual.html">Visualizing Daml Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/interoperability.html">Ledger Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../non-repudiation.html">Non-repudiation</a></li>
</ul>
<p class="caption"><span class="caption-text">Daml Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support/overview.html">Daml Ecosystem Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support/releases.html">Releases and Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/compatibility.html">Portability, Compatibility, and Support Durations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/support.html">Getting Help</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../../_static/images/DAML_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.daml.com/" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">OAuth 2.0 Auth Middleware</a><ul>
<li><a class="reference internal" href="#oauth-2-0-configuration">OAuth 2.0 Configuration</a><ul>
<li><a class="reference internal" href="#request-templates">Request Templates</a><ul>
<li><a class="reference internal" href="#authorization-request">Authorization Request</a><ul>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
<li><a class="reference internal" href="#returns">Returns</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#token-request">Token Request</a><ul>
<li><a class="reference internal" href="#id3">Arguments</a></li>
<li><a class="reference internal" href="#id4">Returns</a></li>
<li><a class="reference internal" href="#id5">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#refresh-request">Refresh Request</a><ul>
<li><a class="reference internal" href="#id7">Arguments</a></li>
<li><a class="reference internal" href="#id8">Returns</a></li>
<li><a class="reference internal" href="#id9">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#deployment-notes">Deployment Notes</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="oauth-2-0-auth-middleware">
<span id="oauth2-middleware"></span><h1>OAuth 2.0 Auth Middleware<a class="headerlink" href="#oauth-2-0-auth-middleware" title="Permalink to this headline">¶</a></h1>
<p>Daml Connect includes an implementation of an auth middleware that supports <a class="reference external" href="https://oauth.net/2/grant-types/authorization-code/">OAuth 2.0 Authorization Code Grant</a>.
The implementation aims to be configurable to support different OAuth 2.0 providers and to allow custom mappings from Daml ledger claims to OAuth 2.0 scopes.</p>
<div class="section" id="oauth-2-0-configuration">
<h2>OAuth 2.0 Configuration<a class="headerlink" href="#oauth-2-0-configuration" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-3">RFC 6749</a> specifies that OAuth 2.0 providers offer two endpoints:
The <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-3.1">authorization endpoint</a>
and the <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-3.2">token endpoint</a>.
The URIs for these endpoints can be configured independently using the following flags:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--oauth-auth</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--oauth-token</span></code></li>
</ul>
<p>The OAuth 2.0 provider may require that the application identify itself using a client identifier and client secret.
These can be specified using the following environment variables:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DAML_CLIENT_ID</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DAML_CLIENT_SECRET</span></code></li>
</ul>
<p>The auth middleware assumes that the OAuth 2.0 provider issues JWT access tokens.
The <code class="docutils literal notranslate"><span class="pre">/auth</span></code> endpoint will validate the token, if available, and ensure that it grants the requested claims.
The auth middleware accepts the same command-line flags as the <a class="reference internal" href="../sandbox.html#sandbox-authorization"><span class="std std-ref">Daml Sandbox</span></a> to define the public key for token validation.</p>
<div class="section" id="request-templates">
<h3>Request Templates<a class="headerlink" href="#request-templates" title="Permalink to this headline">¶</a></h3>
<p>The exact format of OAuth 2.0 requests may vary between providers.
Furthermore, the mapping from Daml ledger claims to OAuth 2.0 scopes is defined by the IAM operator.
For that reason OAuth 2.0 requests made by auth middleware can be configured using user defined <a class="reference external" href="https://jsonnet.org/">Jsonnet</a> templates.
Templates are parameterized configurations expressed as top-level functions.</p>
<div class="section" id="authorization-request">
<h4>Authorization Request<a class="headerlink" href="#authorization-request" title="Permalink to this headline">¶</a></h4>
<p>This template defines the format of the <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-4.1.1">Authorization request</a>.
Use the following command-line flag to use a custom template:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--oauth-auth-template</span></code></li>
</ul>
<div class="section" id="arguments">
<h5>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h5>
<p>The template will be passed the following arguments:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code> (object)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">clientId</span></code> (string) the OAuth 2.0 client identifier</li>
<li><code class="docutils literal notranslate"><span class="pre">clientSecret</span></code> (string) the OAuth 2.0 client secret</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">request</span></code> (object)</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">claims</span></code> (object) the requested claims</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">admin</span></code> (bool)</li>
<li><code class="docutils literal notranslate"><span class="pre">applicationId</span></code> (string or null)</li>
<li><code class="docutils literal notranslate"><span class="pre">actAs</span></code> (list of string)</li>
<li><code class="docutils literal notranslate"><span class="pre">readAs</span></code> (list of string)</li>
</ul>
</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">redirectUri</span></code> (string)</li>
<li><code class="docutils literal notranslate"><span class="pre">state</span></code> (string)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="returns">
<h5>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h5>
<p>The query parameters for the authorization endpoint encoded as an object with string values.</p>
</div>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>local scope(claims) =
  local admin = if claims.admin then &quot;admin&quot;;
  local applicationId = if claims.applicationId != null then &quot;applicationId:&quot; + claims.applicationId;
  local actAs = std.map(function(p) &quot;actAs:&quot; + p, claims.actAs);
  local readAs = std.map(function(p) &quot;readAs:&quot; + p, claims.readAs);
  [admin, applicationId] + actAs + readAs;

function(config, request) {
  &quot;audience&quot;: &quot;https://daml.com/ledger-api&quot;,
  &quot;client_id&quot;: config.clientId,
  &quot;redirect_uri&quot;: request.redirectUri,
  &quot;response_type&quot;: &quot;code&quot;,
  &quot;scope&quot;: std.join(&quot; &quot;, [&quot;offline_access&quot;] + scope(request.claims)),
  &quot;state&quot;: request.state,
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="token-request">
<h4>Token Request<a class="headerlink" href="#token-request" title="Permalink to this headline">¶</a></h4>
<p>This template defines the format of the <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-4.1.3">Token request</a>.
Use the following command-line flag to use a custom template:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--oauth-token-template</span></code></li>
</ul>
<div class="section" id="id3">
<h5>Arguments<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p>The template will be passed the following arguments:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code> (object)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">clientId</span></code> (string) the OAuth 2.0 client identifier</li>
<li><code class="docutils literal notranslate"><span class="pre">clientSecret</span></code> (string) the OAuth 2.0 client secret</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">request</span></code> (object)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">code</span></code> (string)</li>
<li><code class="docutils literal notranslate"><span class="pre">redirectUri</span></code> (string)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id4">
<h5>Returns<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>The request parameters for the token endpoint encoded as an object with string values.</p>
</div>
<div class="section" id="id5">
<h5>Example<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>function(config, request) {
  &quot;client_id&quot;: config.clientId,
  &quot;client_secret&quot;: config.clientSecret,
  &quot;code&quot;: request.code,
  &quot;grant_type&quot;: &quot;authorization_code&quot;,
  &quot;redirect_uri&quot;: request.redirectUri,
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="refresh-request">
<h4>Refresh Request<a class="headerlink" href="#refresh-request" title="Permalink to this headline">¶</a></h4>
<p>This template defines the format of the <a class="reference external" href="https://tools.ietf.org/html/rfc6749#section-6">Refresh request</a>.
Use the following command-line flag to use a custom template:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--oauth-refresh-template</span></code></li>
</ul>
<div class="section" id="id7">
<h5>Arguments<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>The template will be passed the following arguments:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code> (object)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">clientId</span></code> (string) the OAuth 2.0 client identifier</li>
<li><code class="docutils literal notranslate"><span class="pre">clientSecret</span></code> (string) the OAuth 2.0 client secret</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">request</span></code> (object)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">refreshToken</span></code> (string)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h5>Returns<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<p>The request parameters for the authorization endpoint encoded as an object with string values.</p>
</div>
<div class="section" id="id9">
<h5>Example<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>function(config, request) {
  &quot;client_id&quot;: config.clientId,
  &quot;client_secret&quot;: config.clientSecret,
  &quot;grant_type&quot;: &quot;refresh_code&quot;,
  &quot;refresh_token&quot;: request.refreshToken,
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="deployment-notes">
<span id="oauth2-middleware-deployment"></span><h2>Deployment Notes<a class="headerlink" href="#deployment-notes" title="Permalink to this headline">¶</a></h2>
<p>The auth middleware API relies on sharing cookies between the auth middleware and the Daml application.
One way to enable this is to expose the auth middleware and the Daml application under the same domain, e.g. through a reverse proxy.
Note that you will need to specify the external callback URI in that case using the <code class="docutils literal notranslate"><span class="pre">--callback</span></code> command-line flag.</p>
<p>For example, assuming the following nginx configuration snippet:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">server_name</span> <span class="s">example.com</span>
    <span class="s">location</span> <span class="s">/auth/</span> <span class="p">{</span>
      <span class="kn">proxy_pass</span> <span class="s">http://localhost:3000/</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You would invoke the OAuth 2.0 auth middleware with the following flags:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>oauth2-middleware <span class="se">\</span>
    --callback https://example.com/auth/cb <span class="se">\</span>
    --address localhost
    --http-port <span class="m">3000</span>
</pre></div>
</div>
<p>Some browsers reject <code class="docutils literal notranslate"><span class="pre">Secure</span></code> cookies on unencrypted connections even on localhost.
You can pass the command-line flag <code class="docutils literal notranslate"><span class="pre">--cookie-secure</span> <span class="pre">no</span></code> for testing and development on localhost to avoid this.</p>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="index.html" class="da-btn da-btn-label btn-prev" title="Auth Middleware" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="../../error-codes/self-service/index.html" class="da-btn da-btn-label btn-next" title="Self-Service Error Codes (Experimental)" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>